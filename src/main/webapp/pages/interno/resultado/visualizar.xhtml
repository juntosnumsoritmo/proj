<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/template-principal.xhtml">

    <ui:define name="conteudo">
        <div class="conteudo_grafico">
            <p:growl id="messages" />

            <p:dialog id="dialogComentario" widgetVar="dialog" header="#{i18n['partida.comentarios']}" 
                      dynamic="true" closable="false" resizable="false" closeOnEscape="true" draggable="false" 
                      showEffect="fade" hideEffect="fade" modal="true">
                <h:form id="dialog-comentario-form">
                    <p:blockUI block="panel-dialog-comentario" trigger="btnDialogAdicionar" />

                    <h:panelGrid columns="2" width="95%">
                        <p:outputLabel for="comentario" value="#{i18n['partida.comentario']}" />
                        <p:inputTextarea id="comentario" value="#{resultadosControle.comentario.comentario}" 
                                         required="true" minQueryLength="3" 
                                         maxlength="200" style="width: 100%;" />
                    </h:panelGrid>

                    <br />

                    <p:scrollPanel style="width: 400px; height:150px;">
                        <ui:repeat var="comentario" value="#{resultadosControle.comentarioList}">
                            <p:fieldset legend="#{comentario.apostador.nome} - #{comentario.dataHoraFormatada}" style="width: 93%;">
                                <h:outputText value="#{comentario.comentario}" />
                            </p:fieldset>
                            <br />
                        </ui:repeat>
                    </p:scrollPanel>

                    <br />

                    <h:panelGrid columns="2" id="panel-dialog-comentario" style="float: right; text-align: right;">
                        <p:commandButton id="btnDialogAdicionar" widgetVar="btnAdicionar" value="#{i18n['label.adicionar']}"
                                         onclick="btnAdicionar.disable();" oncomplete="btnAdicionar.enable();" 
                                         update="dialog-comentario-form, :messages" style="float: right;"
                                         icon="ui-icon-check" action="#{resultadosControle.criarComentario}"/>

                        <p:commandButton  id="btnDialogCancelar" value="#{i18n['label.voltar']}" 
                                          oncomplete="PF('dialog').hide();" process="@this" 
                                          update="dialog-comentario-form, :messages" style="float: right;"
                                          icon="ui-icon-circle-arrow-w">
                            <p:resetInput target="dialog-comentario-form" />
                        </p:commandButton>
                    </h:panelGrid>
                </h:form>
            </p:dialog>

            <h:form id="resultados-form">
                <p:blockUI block="panel-resultado" trigger="partida" />

                <p:panel id="panel-resultado" header="#{i18n['menu.visualizar']}" style="width: 100%;">
                    <h:panelGrid style="width: 100%; text-align: center;">
                        <p:panelGrid columns="2" style="width: 100%;">
                            <p:outputLabel for="partida" style="float: right" rendered="#{resultadosControle.partida.id != null}" value="#{i18n['desempenho.atleta.partida']}" />
                            <p:selectOneMenu id="partida" value="#{resultadosControle.partida}" converter="selectConverter" rendered="#{resultadosControle.partida.id != null}" style="width: 100%;">
                                <p:ajax update="@this, grafico, grafico2" listener="#{resultadosControle.visualizarResultador}" />
                                <f:selectItems value="#{resultadosControle.partidaList}" var="partida" itemValue="#{partida}" itemLabel="#{partida.descricao}"  />
                            </p:selectOneMenu>

                            <f:facet name="footer">  
                                <p:commandButton id="bntComentario" value="#{i18n['partida.comentarios']}" 
                                                 rendered="#{resultadosControle.partida.id != null}"
                                                 update=":dialog-comentario-form, :messages"
                                                 action="#{resultadosControle.visualizarComentarios}" icon="ui-icon-comment" oncomplete="PF('dialog').show();" />
                                
                                <p:button id="btnVoltar" value="#{i18n['label.voltar']}" outcome="/pages/interno/inicial" icon="ui-icon-circle-arrow-w" />
                            </f:facet> 
                        </p:panelGrid>
                        
                        <br />

                        <p:lineChart id="grafico" legendPosition="ne" extender="configuracao_grafico" shadow="true" 
                                     zoom="true" legendCols="2" rendered="#{resultadosControle.partida.id != null}"
                                     value="#{resultadosControle.partidaPrimeiraSelecaoChart}" style="background-color: wheat;"
                                     title="#{i18n['desempenho.atleta.titulo']}: #{resultadosControle.partida.primeiraSelecao.nome}"
                                     animate="false" datatipFormat="%2$d" minY="0" />

                        <p:lineChart id="grafico2" legendPosition="ne" extender="configuracao_grafico" shadow="true" 
                                     zoom="true" legendCols="2" rendered="#{resultadosControle.partida.id != null}"
                                     value="#{resultadosControle.partidaSegundaSelecaoChart}" style="background-color: wheat;"
                                     title="#{i18n['desempenho.atleta.titulo']}: #{resultadosControle.partida.segundaSelecao.nome}"
                                     animate="false" datatipFormat="%2$d" minY="0" />

                        <h:outputLabel value="#{i18n['msg.nenhum.registro']}" rendered="#{resultadosControle.partida.id == null}" />

                    </h:panelGrid>
                </p:panel>
            </h:form>
        </div>
    </ui:define>

</ui:composition>
